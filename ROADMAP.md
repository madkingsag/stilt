# Stilt Roadmap

- use globs for file loaders
    commands: `glob.sync('**/*.command.js')`

---

new backend stack: what to keep

## @stilt/rest

Depends on: `@stilt/http`

- @GET, @POST, @DELETE, @PUT, etc
- @Request, @Response?
- @httpWriter (raw)
- @serializer
- @successCode? (maybe a global?)
- @Path, @Query, @Body data extractors
    - Should the data extractor system be configurable? (JOI vs validators?)
- User-defined decorators such as `@Pagination`?

## @stilt/http

- KOA as server
- HTTP/2
- Wraps Async functions
- Exposes a "context" global object which depends on the current request. (using async hooks that hook on request and clear on request end).

## @stilt/sequelize

- exports a `@withTransaction` decorator that runs following queries in that
transaction (until method is exited, only for async callbacks trigerred by method tagged as @withTransaction).
- `withTransaction.currentTransaction`
- Registers all models in /models
- Exposes sequelize instance (`app.sequelize`?)

## @stilt/cli

- CLI with custom commands (heroku?)

## @stilt/jwt

Depends on: `@stilt/http`

- Session system
- Global that depends on current request
- Changes made to it are sent back to the client (cookie?)


## TO BE DEFINED

- Auth? (such as @requireAuth on routes)
    - Voters?
- JWT
	- autogenerated secret
	- rotating keys (a list of keys are valid secrets, they expire one at a time after a couple days, tokens are re-encoded using the latest available key)
- .env
	NODE_ENV=development

## @stilt/test

Test project to see how everything works

```
import app from 'NAME';
import appSequelize from 'NAME-sequelize';

app.register(appSequelize);

app.configure({
	commands: __dirname + '/commands',
	sequelize: {
		models: __dirname + '/models',
		migrations: __dirname + '/migrations',
	},
	rest: __dirname + '/controllers',
	graphql: {
		resolvers: __dirname + '/controllers',
		schema: __dirname + '/schema',
	},
});

app.start();
```

MODULES:

app:
	creates the KOA server
	creates the context on request
	deletes the context on request end
	exposes context.jwt?
		any modification to context.jwt is send to client at the end of the request
